Current district population: 4847092
We continue with: Fulton,Jc13A
Target population met or exceeded. Ending district draw
Now drawing half of drawzone 1 into district 4...
We're gonna start at: Haralson,Tallapoosa
Now drawing Haralson,Tallapoosa into district
Current district population: 4681
This precinct has no neighbors it can draw into. Jump elsewhere
The district has 0 allowed neighbors so far
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-20-65fe3538baed> in <module>
----> 1 drand.draw_recursive_map(ga_data, 9691792, 14, None)

~/capp30122/30122-project-redistricting-redux/draw_random_maps.py in draw_recursive_map(df, target_pop, highest, drawzone)
    559 
    560         #start the division process
--> 561         draw_recursive_map(df, int(target_pop / 2), highest, drawzone=1)
    562 
    563     if drawzone == highest:

~/capp30122/30122-project-redistricting-redux/draw_random_maps.py in draw_recursive_map(df, target_pop, highest, drawzone)
    585         right_target_pop = target_pop * (upper_median / highest)
    586 
--> 587     draw_recursive_map(df, left_target_pop, lower_median, drawzone=1) #for VA this is 1-5 (5 dists), for GA this is 1-7 (7 dists)
    588     draw_recursive_map(df, right_target_pop, highest, drawzone=upper_median) #for VA this is 6-11 (6 dists), for GA this is 8-14 (7 dists)
    589 

~/capp30122/30122-project-redistricting-redux/draw_random_maps.py in draw_recursive_map(df, target_pop, highest, drawzone)
    573     print(f"Now drawing half of drawzone {drawzone} into district {upper_median}...")
    574     time.sleep(0.5)
--> 575     draw_recursive_region(df, target_pop, upper_median, drawzone)
    576 
    577     #if n_dists % 2 == 0: #even number, divide evenly

~/capp30122/30122-project-redistricting-redux/draw_random_maps.py in draw_recursive_region(df, target_pop, id, drawzone)
    661             print(f"The district has {len(neighbors_so_far)} allowed neighbors so far")
    662 
--> 663             curr_precinct = random.choice(tuple(neighbors_so_far)) #and this broke for 'Hall, Gillsville'
    664 
    665         print(f"We continue with: {curr_precinct}")

/usr/lib/python3.8/random.py in choice(self, seq)
    288             i = self._randbelow(len(seq))
    289         except ValueError:
--> 290             raise IndexError('Cannot choose from an empty sequence') from None
    291         return seq[i]
    292 

IndexError: Cannot choose from an empty sequence

In [21]: drand.plot_redblue_by_district(ga_data, "G18DGOV", "G18RGOV")
Unable to init server: Could not connect: Connection refused
Unable to init server: Could not connect: Connection refused

(ipython3:3209895): Gdk-CRITICAL **: 11:11:43.548: gdk_cursor_new_for_display: assertion 'GDK_IS_DISPLAY (display)' failed
/home/mbjackson/.local/lib/python3.8/site-packages/geopandas/plotting.py:807: FutureWarning: In a future version, the Index constructor will not infer numeric dtypes when passed object-dtype sequences (matching Series behavior)
  cat = pd.Categorical(values, categories=categories)
District map saved to maps/ga_testmap_0215-111145

In [22]: df[df.loc_prec == 'Haralson,Tallapoosa']['neighbors']
Out[22]: 
1829    [Haralson,Buchanan, Haralson,Waco, Haralson,Be...
Name: neighbors, dtype: object

In [23]: df[df.loc_prec == 'Haralson,Tallapoosa']['neighbors'].iloc[0]
Out[23]: 
array(['Haralson,Buchanan', 'Haralson,Waco', 'Haralson,Berea-Steadman',
       'Haralson,Buncombe'], dtype=object)

In [24]: df[df.loc_prec == 'Haralson,Tallapoosa']['neighbors'].item()
Out[24]: 
array(['Haralson,Buchanan', 'Haralson,Waco', 'Haralson,Berea-Steadman',
       'Haralson,Buncombe'], dtype=object)

In [25]: tallapoosa_neighbors = df[df.loc_prec == 'Haralson,Tallapoosa']['neighbors'].item()

In [26]: for n in tallapoosa_neighbors:
    ...:     print(df.loc[df.loc_prec == n]['dist_id'])
    ...: 
1830    8
Name: dist_id, dtype: int64
1834    8
Name: dist_id, dtype: int64
1838    8
Name: dist_id, dtype: int64
1839    8
Name: dist_id, dtype: int64

In [27]: print(df.loc[df.loc_prec == 'Haralson,Tallapoosa']['dist_id'])
1829    4
Name: dist_id, dtype: int64


#OK so what's happening here is:
#It's being told to draw half of district 1 into district 4
#But this item was surrounded by things assigned to district 8 from before